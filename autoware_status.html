<!DOCTYPE html>
<html>
<head>
    <title>Autoware ì‹¤ì‹œê°„ ë°ì´í„° ê·¸ë˜í”„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .chart-container {
            width: 80%;
            margin: 20px auto;
        }
        #lastUpdateTime {
            text-align: center;
            font-size: 0.9em;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Autoware ì°¨ëŸ‰ ì‹¤ì‹œê°„ ë°ì´í„°</h1>
   
    <div class="chart-container">
        <canvas id="autowareSpeedChart"></canvas>
        <p id="lastUpdateTime">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ë¡œë”© ì¤‘...</p>
    </div>

    <script>
        let speedChart; // ê·¸ë˜í”„ ê°ì²´ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
       
        // ğŸš¨ 1. [í•„ìˆ˜ ìˆ˜ì •] Flask ì„œë²„ì˜ 'ê³µì¸ IP' ì£¼ì†Œë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ì„¸ìš”.
        // ì´ì „ì— í™•ì¸ëœ ë‚´ë¶€ IP(192.168.0.5)ê°€ ì•„ë‹Œ, ì™¸ë¶€ì—ì„œ ì ‘ì† ê°€ëŠ¥í•œ ê³µì¸ IPì—¬ì•¼ í•©ë‹ˆë‹¤.
        // ì˜ˆì‹œ: 'http://110.12.123.123:5000'
        const FLASK_API_BASE_URL = 'http://[Flask ì„œë²„ì˜ ê³µì¸ IP ì£¼ì†Œ]:5000';

       
        // 5ì´ˆë§ˆë‹¤ APIë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê°±ì‹ í•˜ê³  ê·¸ë˜í”„ë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ëŠ” í•¨ìˆ˜
        function fetchAndDrawGraph() {
           
            // 2. [ìˆ˜ì •ë¨] Flask ì„œë²„ì˜ ì „ì²´ API ê²½ë¡œë¡œ ìš”ì²­
            fetch(FLASK_API_BASE_URL + '/api/autoware')
                .then(response => {
                    if (!response.ok) {
                        // 404, 500 ë“± ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ ì²˜ë¦¬
                        throw new Error(`HTTP ì˜¤ë¥˜! ì„œë²„ ìƒíƒœ: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const labels = data.labels;
                    const speedValues = data.speed;

                    const ctx = document.getElementById('autowareSpeedChart').getContext('d');
                   
                    if (speedChart) {
                        // ê¸°ì¡´ ê·¸ë˜í”„ê°€ ìˆìœ¼ë©´ ë°ì´í„°ë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
                        speedChart.data.labels = labels;
                        speedChart.data.datasets[0].data = speedValues;
                        speedChart.update(); // ê·¸ë˜í”„ ì—…ë°ì´íŠ¸ ëª…ë ¹
                    } else {
                        // ìµœì´ˆ ë¡œë“œ ì‹œ ê·¸ë˜í”„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                        speedChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'ì°¨ëŸ‰ ì†ë„ (m/s)',
                                    data: speedValues,
                                    backgroundColor: 'rgba(255, 99, 132, 0.4)',
                                    borderColor: 'rgba(255, 99, 132, 1)',
                                    borderWidth: 2,
                                    tension: 0.1, // ë¶€ë“œëŸ¬ìš´ ì„ 
                                    fill: true
                                }]
                            },
                            options: {
                                responsive: true,
                                animation: {
                                    duration: 0 // ì—…ë°ì´íŠ¸ ì‹œ ì• ë‹ˆë©”ì´ì…˜ì„ ë”
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        title: {
                                            display: true,
                                            text: 'ì†ë„ (m/s)'
                                        }
                                    }
                                }
                            }
                        });
                    }
                   
                    // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
                    document.getElementById('lastUpdateTime').textContent = 'ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ' + new Date().toLocaleTimeString('ko-KR');

                })
                .catch(error => {
                    // 3. [ìˆ˜ì •ë¨] ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë˜ëŠ” CORS ì˜¤ë¥˜ ì‹œ ë©”ì‹œì§€ í‘œì‹œ
                    console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                    document.getElementById('lastUpdateTime').innerHTML = `<span style="color:red;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message} (ì„œë²„ ì£¼ì†Œ ë° ë°©í™”ë²½ í™•ì¸)</span>`;
                });
        }

        // 4. í˜ì´ì§€ ë¡œë“œ ì‹œ ì¦‰ì‹œ ì‹¤í–‰
        fetchAndDrawGraph();

        // 5. 2ì´ˆ(2000ms)ë§ˆë‹¤ ìë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ê°±ì‹ 
        setInterval(fetchAndDrawGraph, 2000);
    </script>
</body>
</html>
