<!DOCTYPE html>
<html>
<head>
    <title>Autoware Remote Control</title>
    <script src="roslib.js"></script>
    
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        button { font-size: 24px; padding: 20px 40px; margin: 10px; }
        #autoBtn { background-color: #4CAF50; color: white; }
        #stopBtn { background-color: #f44336; color: white; }
        #status { font-size: 18px; color: #555; }
    </style>
</head>
<body>

    <h1>Autoware Control Panel</h1>
    <div id="status">Connecting...</div>
    <button id="autoBtn">AUTO (Engage)</button>
    <button id="stopBtn">STOP (Disengage)</button>

    <script>
        // 1. Cloudflare Tunnel에서 설정한 보안 WebSocket 주소
        // 'wss://'를 사용해야 합니다.
        const ROSBRIDGE_URL = 'wss://fml2.shop'; 

        // 2. ROS 객체 생성 및 연결
        const ros = new ROSLIB.Ros({
            url: ROSBRIDGE_URL
        });

        // 연결 이벤트 처리
        ros.on('connection', function() {
            console.log('Connected to websocket server.');
            document.getElementById('status').innerHTML = '✅ Connected';
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
            document.getElementById('status').innerHTML = '❌ Connection Error';
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
            document.getElementById('status').innerHTML = '🔌 Disconnected';
        });

        // 3. 토픽(Topic) 객체 생성
        // Autoware Universe의 engage 토픽과 메시지 타입
        const engageTopic = new ROSLIB.Topic({
            ros: ros,
            name: '/autoware/engage',
            messageType: 'autoware_vehicle_msgs/msg/Engage' // (Humble 기준)
            // Autoware 버전에 따라 'autoware_auto_vehicle_msgs/msg/Engage' 일 수 있습니다.
        });

        // 4. 메시지(Message) 객체 생성
        function publishEngage(isEngaged) {
            // 메시지 구조: { stamp: ..., engage: ... }
            // stamp는 rosbridge에서 자동으로 채워주는 경우가 많으나, 명시적으로 보낼 수도 있습니다.
            const engageMsg = new ROSLIB.Message({
                // stamp: { sec: 0, nanosec: 0 }, // 필요시 시간 정보 추가
                engage: isEngaged 
            });

            console.log(`Publishing: ${isEngaged}`);
            engageTopic.publish(engageMsg);
        }

        // 5. 버튼 이벤트 리스너 연결
        document.getElementById('autoBtn').onclick = function() {
            publishEngage(true);
        };

        document.getElementById('stopBtn').onclick = function() {
            publishEngage(false);
        };

    </script>
</body>
</html>
