<!DOCTYPE html>
<html>
<head>
    <title>Autoware Remote Control</title>
    <script src="roslib.js"></script>
    
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        button { font-size: 24px; padding: 20px 40px; margin: 10px; }
        #autoBtn { background-color: #4CAF50; color: white; }
        #stopBtn { background-color: #f44336; color: white; }
        #status { font-size: 18px; color: #555; }
    </style>
</head>
<body>

    <h1>Autoware Control Panel</h1>
    <div id="status">Connecting...</div>
    <button id="autoBtn">AUTO (Engage)</button>
    <button id="stopBtn">STOP (Disengage)</button>

    <script>
        // 1. Cloudflare Tunnelì—ì„œ ì„¤ì •í•œ ë³´ì•ˆ WebSocket ì£¼ì†Œ
        // 'wss://'ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
        const ROSBRIDGE_URL = 'wss://fml2.shop'; 

        // 2. ROS ê°ì²´ ìƒì„± ë° ì—°ê²°
        const ros = new ROSLIB.Ros({
            url: ROSBRIDGE_URL
        });

        // ì—°ê²° ì´ë²¤íŠ¸ ì²˜ë¦¬
        ros.on('connection', function() {
            console.log('Connected to websocket server.');
            document.getElementById('status').innerHTML = 'âœ… Connected';
        });

        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
            document.getElementById('status').innerHTML = 'âŒ Connection Error';
        });

        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
            document.getElementById('status').innerHTML = 'ğŸ”Œ Disconnected';
        });

        // 3. í† í”½(Topic) ê°ì²´ ìƒì„±
        // Autoware Universeì˜ engage í† í”½ê³¼ ë©”ì‹œì§€ íƒ€ì…
        const engageTopic = new ROSLIB.Topic({
            ros: ros,
            name: '/autoware/engage',
            messageType: 'autoware_vehicle_msgs/msg/Engage' // (Humble ê¸°ì¤€)
            // Autoware ë²„ì „ì— ë”°ë¼ 'autoware_auto_vehicle_msgs/msg/Engage' ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        });

        // 4. ë©”ì‹œì§€(Message) ê°ì²´ ìƒì„±
        function publishEngage(isEngaged) {
            // ë©”ì‹œì§€ êµ¬ì¡°: { stamp: ..., engage: ... }
            // stampëŠ” rosbridgeì—ì„œ ìë™ìœ¼ë¡œ ì±„ì›Œì£¼ëŠ” ê²½ìš°ê°€ ë§ìœ¼ë‚˜, ëª…ì‹œì ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
            const engageMsg = new ROSLIB.Message({
                // stamp: { sec: 0, nanosec: 0 }, // í•„ìš”ì‹œ ì‹œê°„ ì •ë³´ ì¶”ê°€
                engage: isEngaged 
            });

            console.log(`Publishing: ${isEngaged}`);
            engageTopic.publish(engageMsg);
        }

        // 5. ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        document.getElementById('autoBtn').onclick = function() {
            publishEngage(true);
        };

        document.getElementById('stopBtn').onclick = function() {
            publishEngage(false);
        };

    </script>
</body>
</html>
