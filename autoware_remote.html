<!DOCTYPE html>
<html>
<head>
    <title>Autoware Remote Control</title>
    <meta charset="utf-8">
    <style>
        body { font-family: sans-serif; text-align: center; margin-top: 50px; }
        button { font-size: 24px; padding: 20px 40px; margin: 10px; cursor: pointer; }
        #autoButton { background-color: #4CAF50; color: white; border: none; }
        #stopButton { background-color: #f44336; color: white; border: none; }
        #status { margin-top: 20px; font-size: 18px; }
    </style>
</head>
<body>

    <h1>Autoware 원격 제어</h1>
    
    <button id="autoButton">AUTO</button>
    <button id="stopButton">STOP</button>

    <div id="status">연결 상태: 대기 중...</div>

    <script src="https://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>

    <script>
        // --- 1. rosbridge 서버 주소 설정 ---
        // !!! 중요 !!!
        // Autoware PC(rosbridge 실행 PC)의 IP 주소로 변경하세요.
        // 예: 'ws://192.168.1.100:9090'
        // GCP 등 외부 서버를 경유한다면 해당 서버의 주소입니다.
        const rosbridgeHost = 'ws://192.168.0.15:9090'; 
        // ------------------------------------

        const statusElement = document.getElementById('status');
        const autoButton = document.getElementById('autoButton');
        const stopButton = document.getElementById('stopButton');

        // ROS Bridge 연결 객체 생성
        var ros = new ROSLIB.Ros({
            url: rosbridgeHost
        });

        // 연결 성공 시
        ros.on('connection', function() {
            console.log('Connected to websocket server.');
            statusElement.innerHTML = '연결 상태: 연결됨';
        });

        // 연결 오류 시
        ros.on('error', function(error) {
            console.log('Error connecting to websocket server: ', error);
            statusElement.innerHTML = '연결 상태: 오류 발생 (주소 확인 필요)';
        });

        // 연결 종료 시
        ros.on('close', function() {
            console.log('Connection to websocket server closed.');
            statusElement.innerHTML = '연결 상태: 연결 끊김';
        });

        // --- 2. 토픽 발행(Publisher) 설정 ---
        var engagePublisher = new ROSLIB.Topic({
            ros: ros,
            name: '/autoware/engage',
            messageType: 'autoware_auto_vehicle_msgs/msg/Engage'
        });

        // --- 3. 메시지 객체 생성 ---
        var autoMessage = new ROSLIB.Message({
            engage: true
        });

        var stopMessage = new ROSLIB.Message({
            engage: false
        });

        // --- 4. 버튼 클릭 이벤트 리스너 ---
        autoButton.onclick = function() {
            console.log('Publishing AUTO message (true)');
            engagePublisher.publish(autoMessage);
            statusElement.innerHTML = '명령 전송: AUTO';
        };

        stopButton.onclick = function() {
            console.log('Publishing STOP message (false)');
            engagePublisher.publish(stopMessage);
            statusElement.innerHTML = '명령 전송: STOP';
        };

    </script>

</body>
</html>
